; ============================================================
; ESP-Nail v2 - PlatformIO Configuration
; FreeRTOS + WiFi + BLE + OTA + LittleFS
; ============================================================

[env]
platform = espressif32@^6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
board_build.partitions = default_16MB.csv
board_build.filesystem = littlefs

lib_deps =
    ; Display
    adafruit/Adafruit SSD1306@^2.5.7
    adafruit/Adafruit GFX Library@^1.11.5
    adafruit/Adafruit BusIO@^1.14.1
    ; Thermocouple
    adafruit/Adafruit MAX31855 library@^1.3.0
    ; Async Web Server
    me-no-dev/ESP Async WebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1
    ; JSON
    bblanchon/ArduinoJson@^7.0.0
    ; MQTT
    knolleary/PubSubClient@^2.8
    ; mDNS is built-in to ESP32 Arduino core

build_flags =
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM=0
    -Wall
    -Wextra
    -Wno-unused-parameter

; Custom partition table for OTA + LittleFS
board_build.partitions = partitions_ota.csv

; ============================================================
; Build Environments
; ============================================================

; --- Single Channel (Model S) ---
[env:single]
build_flags =
    ${env.build_flags}
    -DNUM_CHANNELS=1
    -DMODEL_NAME=\"ESP-Nail_S\"
    -DENABLE_WIFI=1
    -DENABLE_BLE=1
    -DENABLE_OTA=1
    -DENABLE_MQTT=0
    -DDISPLAY_TYPE_SSD1306=1

; --- Dual Channel (Model D) ---
[env:dual]
build_flags =
    ${env.build_flags}
    -DNUM_CHANNELS=2
    -DMODEL_NAME=\"ESP-Nail_D\"
    -DENABLE_WIFI=1
    -DENABLE_BLE=1
    -DENABLE_OTA=1
    -DENABLE_MQTT=0
    -DDISPLAY_TYPE_SSD1306=1

; --- Quad Channel (Model Q) ---
[env:quad]
build_flags =
    ${env.build_flags}
    -DNUM_CHANNELS=4
    -DMODEL_NAME=\"ESP-Nail_Q\"
    -DENABLE_WIFI=1
    -DENABLE_BLE=1
    -DENABLE_OTA=1
    -DENABLE_MQTT=0
    -DDISPLAY_TYPE_SSD1306=1

; --- Single Channel + Color TFT ---
[env:single_color]
build_flags =
    ${env.build_flags}
    -DNUM_CHANNELS=1
    -DMODEL_NAME=\"ESP-Nail_S_Pro\"
    -DENABLE_WIFI=1
    -DENABLE_BLE=1
    -DENABLE_OTA=1
    -DENABLE_MQTT=1
    -DDISPLAY_TYPE_ST7789=1
lib_deps =
    ${env.lib_deps}
    adafruit/Adafruit ST7735 and ST7789 Library@^1.10.0

; --- Minimal (no WiFi/BLE, smallest footprint) ---
[env:minimal]
build_flags =
    ${env.build_flags}
    -DNUM_CHANNELS=1
    -DMODEL_NAME=\"ESP-Nail_Lite\"
    -DENABLE_WIFI=0
    -DENABLE_BLE=0
    -DENABLE_OTA=0
    -DENABLE_MQTT=0
    -DDISPLAY_TYPE_SSD1306=1

; --- Test (native unit tests) ---
[env:test]
platform = native
build_flags =
    -DNUM_CHANNELS=2
    -DUNIT_TEST=1
test_build_src = yes
